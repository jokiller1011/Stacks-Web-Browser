<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Stacks — Mini Browser (proxy tabs)</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root{
  --bg:#071025; --panel:#0e1725; --muted:#2b3a50; --text:#e6eef8;
  --accent:#6f9bff; --accent2:#8ff0ff; --danger:#ff6b6b;
  --tab-inactive:#0b1220; --tab-active:#14203a;
  --radius:12px;
}
[data-theme="light"]{
  --bg:#f4f7fb; --panel:#ffffff; --muted:#d7dbe6; --text:#071025;
  --tab-inactive:#eef2f7; --tab-active:#ffffff;
}
*{box-sizing:border-box}
body{margin:0;height:100vh;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial; background:linear-gradient(180deg,var(--bg),#021022); color:var(--text); display:flex; flex-direction:column;}

/* Tabs */
.tabs { display:flex; gap:8px; padding:10px; align-items:center; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); border-bottom:1px solid rgba(255,255,255,0.03); overflow:auto;}
.tab { display:flex; align-items:center; gap:10px; padding:8px 14px; border-radius:12px 12px 6px 6px; cursor:pointer; background:var(--tab-inactive); color:var(--text); min-width:140px; box-shadow:0 6px 18px rgba(0,0,0,.35); }
.tab.active{ background: linear-gradient(180deg,var(--tab-active), rgba(255,255,255,0.02)); box-shadow: 0 10px 30px rgba(0,0,0,.45); transform:translateY(-2px); }
.tab .title{ font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.tab .close{ margin-left:6px; opacity:.7; border-radius:6px; padding:3px; background:transparent; border:0; cursor:pointer; color:inherit; }
.newtab{ padding:8px 10px; border-radius:10px; background:transparent; border:1px dashed rgba(255,255,255,0.06); cursor:pointer; color:var(--accent); }

/* Address */
.addressbar{ display:flex; gap:8px; align-items:center; padding:10px; border-bottom:1px solid rgba(255,255,255,0.03); background:var(--panel); }
.controls{ display:flex; gap:6px; }
.btn{ background:transparent; border:1px solid rgba(255,255,255,0.04); padding:8px; border-radius:8px; cursor:pointer; color:var(--text); min-width:40px; display:inline-grid; place-items:center; }
.btn:active{ transform:translateY(1px); }
.urlinput{ flex:1; display:flex; gap:6px; align-items:center; background:rgba(255,255,255,0.02); padding:6px; border-radius:10px; border:1px solid rgba(255,255,255,0.03); }
.input-url{ flex:1; padding:8px 10px; background:transparent; border:0; outline:none; color:var(--text); font-weight:600; min-width:60px; }
.go-btn{ padding:8px 12px; border-radius:8px; background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#021028; font-weight:700; border:0; cursor:pointer; }

/* bookmarks */
.bookmarkbar{ display:flex; gap:8px; padding:8px 10px; border-bottom:1px solid rgba(255,255,255,0.02); background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); overflow:auto; }
.bookmark{ padding:6px 10px; border-radius:8px; background:rgba(255,255,255,0.02); cursor:pointer; font-weight:600; white-space:nowrap; }

/* content */
.content{ flex:1; padding:12px; display:flex; gap:12px; align-items:stretch; }
.frame-wrap{ flex:1; background:var(--panel); border-radius:12px; border:1px solid rgba(255,255,255,0.03); overflow:hidden; position:relative; }
.iframe{ width:100%; height:100%; border:0; display:block; background:white; }

/* overlay */
.overlay{ position:absolute; inset:10px; display:flex; align-items:center; justify-content:center; pointer-events:none; }
.card{ pointer-events:auto; background:rgba(0,0,0,0.6); padding:18px; border-radius:10px; color:var(--text); max-width:820px; text-align:center; border:1px solid rgba(255,255,255,0.04); }

/* settings */
.settings-panel{ position:fixed; right:-420px; top:0; width:420px; height:100vh; background:var(--panel); border-left:1px solid rgba(255,255,255,0.04); padding:18px; transition:right .28s ease; z-index:9999; overflow:auto; }
.settings-panel.open{ right:0; }
.row{ display:flex; gap:8px; align-items:center; }
/* small */
.small{ font-size:13px; opacity:.9; }
footer.notice{ text-align:center; padding:8px 10px; font-size:12px; opacity:.8; color:var(--muted) }

/* responsive */
@media (max-width:900px){ .tab{ min-width:92px } .bookmark{ display:none } .tabs{ gap:6px } .settings-panel{ width:100%; } }
</style>
</head>
<body>
  <div class="tabs" id="tabsBar" role="tablist" aria-label="Tabs"></div>
  <div style="padding:0 10px;">
    <button class="newtab" id="newTabBtn" title="New Tab"><i class="fa fa-plus"></i> New Tab</button>
  </div>

  <div class="addressbar" aria-label="Navigation">
    <div class="controls">
      <button class="btn" id="backBtn" title="Back"><i class="fa fa-arrow-left"></i></button>
      <button class="btn" id="fwdBtn" title="Forward"><i class="fa fa-arrow-right"></i></button>
      <button class="btn" id="reloadBtn" title="Reload"><i class="fa fa-rotate"></i></button>
      <button class="btn" id="homeBtn" title="Home"><i class="fa fa-house"></i></button>
    </div>

    <div class="urlinput" style="margin-left:8px;">
      <input id="urlInput" class="input-url" type="text" placeholder="Type a URL or search (press Enter)" />
      <button class="go-btn" id="goBtn">Go</button>
    </div>

    <div style="width:12px"></div>

    <div style="display:flex;gap:8px;align-items:center;">
      <button class="btn small" id="bookmarkThis" title="Bookmark tab"><i class="fa fa-bookmark"></i></button>
      <button class="btn small" id="openSettings" title="Settings"><i class="fa fa-gear"></i></button>
    </div>
  </div>

  <div class="bookmarkbar" id="bookmarkBar" aria-label="Bookmarks"></div>

  <div class="content">
    <div class="frame-wrap" id="frameWrap">
      <div id="overlay" class="overlay" style="display:none"><div class="card" id="overlayCard"></div></div>
    </div>
  </div>

  <footer class="notice small">Stacks — client-side proxy tabs. Proxies may be unreliable. Use responsibly.</footer>

  <!-- Settings panel -->
  <div class="settings-panel" id="settingsPanel" aria-hidden="true">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <strong>Settings</strong>
      <div>
        <button class="btn small" id="closeSettingsBtn"><i class="fa fa-xmark"></i></button>
      </div>
    </div>

    <div style="margin-bottom:10px">
      <label class="small">Proxy prefixes (one per line). The prefix will be prepended to the target URL. Example: <code>https://r.jina.ai/http://</code></label>
      <textarea id="proxyTextarea" rows="6" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)"></textarea>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn small" id="saveProxyBtn">Save</button>
        <button class="btn small" id="resetProxyBtn">Reset Defaults</button>
      </div>
    </div>

    <div style="margin-bottom:10px">
      <label class="small">Home URL</label>
      <input id="homeInput" type="text" placeholder="https://example.com" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)" />
    </div>

    <div style="margin-bottom:10px">
      <label class="small">Theme</label>
      <div style="display:flex;gap:8px;margin-top:6px">
        <button class="btn small" id="toggleThemeBtn">Toggle Dark/Light</button>
        <span id="themeIndicator" class="small"></span>
      </div>
    </div>

    <div style="margin-top:6px;display:flex;gap:8px">
      <button class="btn small" id="exportBookmarksBtn">Export Bookmarks</button>
      <button class="btn small" id="importBookmarksBtn">Import Bookmarks</button>
      <button class="btn small" id="clearBookmarksBtn">Clear Bookmarks</button>
    </div>

    <div style="margin-top:14px" class="small">
      <strong>Note</strong>
      <div style="margin-top:6px">Public proxies may be slow or blocked. For best results run a small server-side proxy (ask me and I'll provide a tiny Node/Python example).</div>
    </div>
  </div>

<script>
/* Stacks browser — single-file
 - Tabs, per-tab history
 - Proxy fallback loader
 - Inject small script into fetched HTML so links/forms stay inside Stacks
 - Bookmarks + settings saved in localStorage
*/

/* ========= Config / Defaults ========= */
const DEFAULT_PROXIES = [
  // Public prefixes known to sometimes return raw HTML. Replace with your own for reliability.
  'https://r.jina.ai/http://',
  'https://r.jina.ai/http://', // duplicate intentionally for quick fallback rotation
  'https://api.allorigins.win/raw?url='
];
const DEFAULT_BOOKMARKS = [
  {title:'Google', url:'https://google.com'},
  {title:'Bing', url:'https://bing.com'},
  {title:'YouTube', url:'https://youtube.com'},
  {title:'Wikipedia', url:'https://wikipedia.org'}
];
const DEFAULT_HOME = 'https://example.com';

/* ========= State ========= */
let proxies = JSON.parse(localStorage.getItem('stacks:proxies')||'null') || DEFAULT_PROXIES.slice();
let bookmarks = JSON.parse(localStorage.getItem('stacks:bookmarks')||'null') || DEFAULT_BOOKMARKS.slice();
let theme = localStorage.getItem('stacks:theme') || 'dark';
let homeUrl = localStorage.getItem('stacks:home') || DEFAULT_HOME;

let tabs = []; // {id, title, url, history:[], forward:[], iframe, container, blobUrl}
let activeTabId = null;

/* ========= DOM ========= */
const tabsBar = document.getElementById('tabsBar');
const newTabBtn = document.getElementById('newTabBtn');
const frameWrap = document.getElementById('frameWrap');
const urlInput = document.getElementById('urlInput');
const goBtn = document.getElementById('goBtn');
const backBtn = document.getElementById('backBtn');
const fwdBtn = document.getElementById('fwdBtn');
const reloadBtn = document.getElementById('reloadBtn');
const homeBtn = document.getElementById('homeBtn');
const bookmarkBar = document.getElementById('bookmarkBar');
const bookmarkThis = document.getElementById('bookmarkThis');
const openSettings = document.getElementById('openSettings');
const settingsPanel = document.getElementById('settingsPanel');
const closeSettingsBtn = document.getElementById('closeSettingsBtn');
const proxyTextarea = document.getElementById('proxyTextarea');
const saveProxyBtn = document.getElementById('saveProxyBtn');
const resetProxyBtn = document.getElementById('resetProxyBtn');
const homeInput = document.getElementById('homeInput');
const toggleThemeBtn = document.getElementById('toggleThemeBtn');
const themeIndicator = document.getElementById('themeIndicator');
const exportBookmarksBtn = document.getElementById('exportBookmarksBtn');
const importBookmarksBtn = document.getElementById('importBookmarksBtn');
const clearBookmarksBtn = document.getElementById('clearBookmarksBtn');
const settingsPanelEl = document.getElementById('settingsPanel');
const overlay = document.getElementById('overlay');
const overlayCard = document.getElementById('overlayCard');

/* ========= Helpers ========= */
function saveState(){ localStorage.setItem('stacks:proxies', JSON.stringify(proxies)); localStorage.setItem('stacks:bookmarks', JSON.stringify(bookmarks)); localStorage.setItem('stacks:theme', theme); localStorage.setItem('stacks:home', homeUrl); }
function gid() { return Math.random().toString(36).slice(2,9); }
function setTheme(t){ theme=t; document.documentElement.setAttribute('data-theme', theme); themeIndicator.textContent = theme; saveState(); }
setTheme(theme);

/* ========= UI Rendering ========= */
function renderTabs(){
  tabsBar.innerHTML = '';
  tabs.forEach(t=>{
    const el = document.createElement('div');
    el.className = 'tab' + (t.id===activeTabId ? ' active' : '');
    el.setAttribute('data-id', t.id);
    el.innerHTML = `<span class="title" title="${escapeHtml(t.title||t.url||'New Tab')}">${escapeHtml(t.title||t.url||'New Tab')}</span><button class="close" title="Close tab"><i class="fa fa-xmark"></i></button>`;
    el.addEventListener('click', (ev)=>{
      if(ev.target.closest('.close')){ closeTab(t.id); ev.stopPropagation(); return; }
      activateTab(t.id);
    });
    tabsBar.appendChild(el);
  });
}

function renderBookmarks(){
  bookmarkBar.innerHTML = '';
  bookmarks.forEach((b, i)=>{
    const btn = document.createElement('button');
    btn.className='bookmark';
    btn.textContent = b.title || b.url;
    btn.title = b.url;
    btn.onclick = ()=> { urlInput.value = b.url; loadUrlInActiveTab(b.url); };
    btn.oncontextmenu = (e)=>{ e.preventDefault(); if(confirm('Remove bookmark?')){ bookmarks.splice(i,1); saveState(); renderBookmarks(); } };
    bookmarkBar.appendChild(btn);
  });
  // add button to add bookmark manually
  const addBtn = document.createElement('button');
  addBtn.className='bookmark';
  addBtn.textContent = '+';
  addBtn.title = 'Add current page as bookmark';
  addBtn.onclick = ()=>{
    const t = tabs.find(x=>x.id===activeTabId);
    if(!t || !t.url) return alert('No page loaded to bookmark');
    bookmarks.push({ title: t.title || t.url, url: t.url });
    saveState(); renderBookmarks();
  };
  bookmarkBar.appendChild(addBtn);
}

/* ========= Tab functions ========= */
function createTab(initialUrl){
  const id = gid();
  const title = 'New Tab';
  // create DOM container for iframe
  const container = document.createElement('div');
  container.style.width='100%'; container.style.height='100%'; container.style.display='none';
  const iframe = document.createElement('iframe');
  iframe.className='iframe';
  iframe.sandbox = 'allow-scripts allow-forms allow-popups allow-same-origin';
  container.appendChild(iframe);
  frameWrap.appendChild(container);
  const tab = { id, title, url:'', history:[], forward:[], iframe, container, blobUrl:null };
  tabs.push(tab);
  renderTabs();
  activateTab(id);
  if(initialUrl) loadUrlInTab(tab, initialUrl);
  return tab;
}

function activateTab(id){
  activeTabId = id;
  tabs.forEach(t=> t.container.style.display = (t.id===id ? 'block' : 'none'));
  renderTabs();
  const t = tabs.find(x=>x.id===activeTabId);
  urlInput.value = t && t.url ? t.url : '';
  backBtn.disabled = !(t && t.history.length>1);
  fwdBtn.disabled = !(t && t.forward.length>0);
}

function closeTab(id){
  const idx = tabs.findIndex(t=>t.id===id);
  if(idx===-1) return;
  const t = tabs[idx];
  if(t.blobUrl) try{ URL.revokeObjectURL(t.blobUrl); }catch(e){}
  t.container.remove();
  tabs.splice(idx,1);
  if(tabs.length) activateTab(tabs[Math.max(0, idx-1)].id);
  else createTab(homeUrl);
}

/* ========= Proxy fetcher with fallback ========= */
async function fetchViaProxies(targetUrl, perProxyTimeout=9000){
  let lastErr = null;
  for(let i=0;i<proxies.length;i++){
    const prefix = proxies[i];
    // Some proxies expect ?url= style or raw concatenation — we assume the stored prefix is ready to concat
    const probe = prefix + targetUrl;
    try{
      const controller = new AbortController();
      const tid = setTimeout(()=>controller.abort(), perProxyTimeout);
      const resp = await fetch(probe, { signal: controller.signal, headers: {'X-Requested-With':'Stacks'} });
      clearTimeout(tid);
      if(!resp.ok) throw new Error('HTTP '+resp.status);
      const text = await resp.text();
      if(!text || text.length < 16) throw new Error('Empty body');
      return text;
    }catch(err){
      console.warn('Proxy failed', prefix, err);
      lastErr = err;
      // try next
    }
  }
  throw lastErr || new Error('All proxies failed');
}

/* ========= Content injection helpers ========= */
/* We inject a small script into pages we load so link clicks/forms/open in iframe are intercepted
   and forwarded to parent.postMessage for the host app to handle (keeps navigation inside the tab).
   Because blob URLs created from fetched html are same-origin with the page we can manipulate the iframe doc.
*/
function makeInjectedHtml(originalHtml, baseUrl){
  // small helper script to intercept links & forms & window.open
  const hook = `
<script>
(function(){
  try{
    // set base so relative links work
    var base = document.createElement('base'); base.href = ${JSON.stringify(baseUrl)}; document.head.insertBefore(base, document.head.firstChild);
  }catch(e){}
  function resolve(h){ try{ return new URL(h, location.href).href; }catch(e){ return h; } }
  function sendNav(url){ parent.postMessage({__stacks_nav: url}, '*'); }
  // intercept link clicks
  document.addEventListener('click', function(e){
    var a = e.target.closest && e.target.closest('a');
    if(!a) return;
    var href = a.getAttribute('href');
    if(!href) return;
    if(href.startsWith('javascript:')) return;
    e.preventDefault();
    sendNav(resolve(href));
  }, true);
  // intercept forms
  document.addEventListener('submit', function(e){
    var f = e.target;
    if(!f || !f.action) return;
    e.preventDefault();
    var action = resolve(f.action || location.href);
    var fm = new FormData(f);
    var params = new URLSearchParams();
    for(var p of fm.entries()) params.append(p[0], p[1]);
    // send as GET with params appended to action (simple approach)
    sendNav(action + (action.includes('?') ? '&' : '?') + params.toString());
  }, true);
  // override window.open to route through parent
  (function(orig){
    window.open = function(u,t){ try{ parent.postMessage({__stacks_nav: u}, '*'); }catch(e){} };
  })(window.open);
})();
<\/script>
`;
  // Insert the hook before </body> if possible, otherwise append
  if(/<\\/body>/i.test(originalHtml)){
    return originalHtml.replace(/<\\/body>/i, hook + '</body>');
  }else{
    return originalHtml + hook;
  }
}

/* ========= Main loader ========= */
async function loadUrlInTab(tab, rawAddress){
  if(!rawAddress) return;
  let address = rawAddress.trim();
  // support search when spaces present
  if(address.includes(' ')) address = 'https://duckduckgo.com/?q=' + encodeURIComponent(address);
  else if(!/^https?:\\/\\//i.test(address)) address = 'https://' + address;
  urlInput.value = address;
  showOverlay('Loading…');
  try{
    const html = await fetchViaProxies(address, 10000); // 10s per proxy
    // add base + inject script
    const processed = makeInjectedHtml(html, address);
    const blob = new Blob([processed], { type: 'text/html' });
    if(tab.blobUrl) try{ URL.revokeObjectURL(tab.blobUrl); }catch(e){}
    tab.blobUrl = URL.createObjectURL(blob);
    tab.iframe.src = tab.blobUrl;
    tab.url = address;
    tab.history.push(address);
    tab.forward = [];
    // update title after load
    tab.iframe.onload = () => {
      try{
        const doc = tab.iframe.contentDocument;
        const ttitle = doc && doc.title ? doc.title : new URL(address).hostname;
        tab.title = ttitle;
        const titleEl = tabsBar.querySelector(`.tab[data-id="${tab.id}"] .title`);
        if(titleEl) titleEl.textContent = ttitle;
      }catch(e){ console.warn('title read failed', e); }
      hideOverlay();
      activateTab(tab.id);
    };
  }catch(err){
    console.error('load failed', err);
    showOverlay(`<div style="max-width:640px;text-align:left"><strong style="color:var(--danger)">Failed to load</strong><div class="small" style="margin-top:8px">Tried configured proxies but none returned usable content.<div style="margin-top:8px;color:var(--muted)">${escapeHtml(err.message||'Unknown error')}</div></div><div style="margin-top:12px;display:flex;gap:8px"><button id="retryLoad" class="btn small">Retry</button><button id="openExtern" class="btn small">Open in real tab</button></div></div>`);
    document.getElementById('retryLoad').onclick = ()=>{ hideOverlay(); loadUrlInTab(tab, rawAddress); };
    document.getElementById('openExtern').onclick = ()=>{ window.open(rawAddress, '_blank'); };
  }
}

/* ========= Message handling: iframe -> parent navigation ======== */
window.addEventListener('message', (ev)=>{
  try{
    const d = ev.data;
    if(d && d.__stacks_nav){
      const url = d.__stacks_nav;
      const t = tabs.find(x=>x.id===activeTabId);
      if(t) loadUrlInTab(t, url);
    }
  }catch(e){}
});

/* ========= Misc UI helpers ========= */
function showOverlay(htmlOrText){ overlay.style.display='flex'; overlayCard.innerHTML = htmlOrText; }
function hideOverlay(){ overlay.style.display='none'; overlayCard.innerHTML=''; }
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* ========= Event bindings ========= */
newTabBtn.addEventListener('click', ()=> createTab(homeUrl));
goBtn.addEventListener('click', ()=> { const t = tabs.find(x=>x.id===activeTabId); if(!t) return; loadUrlInTab(t, urlInput.value); });
urlInput.addEventListener('keydown', (e)=> { if(e.key==='Enter') goBtn.click(); });

backBtn.addEventListener('click', ()=> {
  const t = tabs.find(x=>x.id===activeTabId); if(!t) return;
  if(t.history.length > 1){
    const cur = t.history.pop();
    t.forward.push(cur);
    const prev = t.history[t.history.length-1];
    loadUrlInTab(t, prev);
  }
});
fwdBtn.addEventListener('click', ()=> {
  const t = tabs.find(x=>x.id===activeTabId); if(!t) return;
  if(t.forward && t.forward.length){
    const nxt = t.forward.pop();
    loadUrlInTab(t, nxt);
  }
});
reloadBtn.addEventListener('click', ()=> {
  const t = tabs.find(x=>x.id===activeTabId); if(!t) return;
  if(t.url) loadUrlInTab(t, t.url);
});
homeBtn.addEventListener('click', ()=> {
  const t = tabs.find(x=>x.id===activeTabId); if(!t) return;
  loadUrlInTab(t, homeUrl);
});

bookmarkThis.addEventListener('click', ()=> {
  const t = tabs.find(x=>x.id===activeTabId); if(!t || !t.url) return alert('No page to bookmark');
  bookmarks.push({ title: t.title || t.url, url: t.url });
  saveState(); renderBookmarks();
});

openSettings.addEventListener('click', ()=> {
  proxyTextarea.value = proxies.join('\\n');
  homeInput.value = homeUrl;
  settingsPanelEl.classList.add('open');
});
closeSettingsBtn.addEventListener('click', ()=> settingsPanelEl.classList.remove('open'));

saveProxyBtn.addEventListener('click', ()=> {
  const items = proxyTextarea.value.split('\\n').map(s=>s.trim()).filter(Boolean);
  if(items.length) proxies = items;
  saveState();
  alert('Saved proxies');
});
resetProxyBtn.addEventListener('click', ()=> { proxies = DEFAULT_PROXIES.slice(); proxyTextarea.value = proxies.join('\\n'); saveState(); alert('Defaults restored'); });
toggleThemeBtn.addEventListener('click', ()=> { setTheme(theme==='dark'?'light':'dark'); alert('Theme set to '+theme); });
homeInput.addEventListener('change', ()=> { homeUrl = homeInput.value || DEFAULT_HOME; saveState(); alert('Home set') });

exportBookmarksBtn.addEventListener('click', ()=> {
  const data = JSON.stringify(bookmarks, null, 2);
  const a = document.createElement('a'); a.href = 'data:application/json;charset=utf-8,' + encodeURIComponent(data); a.download = 'stacks-bookmarks.json'; a.click();
});
importBookmarksBtn.addEventListener('click', ()=> {
  const f = document.createElement('input'); f.type='file'; f.accept='.json';
  f.onchange = (e)=>{
    const file = e.target.files[0]; if(!file) return;
    const r = new FileReader(); r.onload = ev => {
      try{ bookmarks = JSON.parse(ev.target.result); saveState(); renderBookmarks(); alert('Imported'); }catch(e){ alert('Invalid file'); }
    }; r.readAsText(file);
  }; f.click();
});
clearBookmarksBtn.addEventListener('click', ()=> { if(confirm('Clear bookmarks?')){ bookmarks=[]; saveState(); renderBookmarks(); } });

/* ========= Boot ========= */
function boot(){
  renderBookmarks();
  // create one tab and load home
  const t = createTab();
  loadUrlInTab(t, homeUrl);
}
boot();

/* expose for debugging */
window._stacks = { tabs, proxies, bookmarks, loadUrlInTab };
</script>
</body>
</html>
